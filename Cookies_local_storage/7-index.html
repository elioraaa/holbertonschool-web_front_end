<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
</head>
<body>

<script>
  const availableItems = ["Shampoo", "Soap", "Sponge", "Water"];

  function storageAvailable() {
    try {
      const test = "__test__";
      sessionStorage.setItem(test, "1");
      sessionStorage.removeItem(test);
      return true;
    } catch (e) {
      return false;
    }
  }

  function getCartFromStorage() {
    const cart = sessionStorage.getItem("cart");
    if (!cart) return {};
    return JSON.parse(cart);
  }

  function addItemToCart(item) {
    const cart = getCartFromStorage();

    if (cart[item]) {
      cart[item] += 1;
    } else {
      cart[item] = 1;
    }

    sessionStorage.setItem("cart", JSON.stringify(cart));
    displayCart();
  }

  function removeItemfromCart(item) {
    const cart = getCartFromStorage();
    delete cart[item];
    sessionStorage.setItem("cart", JSON.stringify(cart));
    displayCart();
  }

  function clearCart() {
    sessionStorage.clear();
    displayCart();
  }

  function createStore() {
    const h2 = document.createElement("h2");
    h2.textContent = "Available products:";
    document.body.appendChild(h2);

    const ul = document.createElement("ul");

    availableItems.forEach(function(item) {
      const li = document.createElement("li");
      li.textContent = item;

      li.addEventListener("click", function() {
        addItemToCart(item);
      });

      ul.appendChild(li);
    });

    document.body.appendChild(ul);
  }

  function displayCart() {
    let cartDiv = document.getElementById("cart");

    if (!cartDiv) {
      const h2 = document.createElement("h2");
      h2.textContent = "Your cart:";
      document.body.appendChild(h2);

      cartDiv = document.createElement("div");
      cartDiv.id = "cart";
      document.body.appendChild(cartDiv);
    }

    updateCart();
  }

  function updateCart() {
    const cartDiv = document.getElementById("cart");
    cartDiv.innerHTML = "";

    const cart = getCartFromStorage();
    const ul = document.createElement("ul");

    const keys = Object.keys(cart);

    if (keys.length === 0) {
      const li = document.createElement("li");
      li.textContent = "Your cart is empty";
      ul.appendChild(li);
    } else {

      const clearLi = document.createElement("li");
      clearLi.textContent = "Clear my cart";
      clearLi.style.cursor = "pointer";
      clearLi.addEventListener("click", clearCart);
      ul.appendChild(clearLi);

      keys.forEach(function(item) {
        const li = document.createElement("li");
        li.textContent = item + " x " + cart[item] + " ";

        const removeSpan = document.createElement("span");
        removeSpan.textContent = "(remove)";
        removeSpan.style.cursor = "pointer";
        removeSpan.style.marginLeft = "5px";

        removeSpan.addEventListener("click", function() {
          removeItemfromCart(item);
        });

        li.appendChild(removeSpan);
        ul.appendChild(li);
      });
    }

    cartDiv.appendChild(ul);
  }

  if (!storageAvailable()) {
    alert("Sorry, your browser does not support Web storage. Try again with a better one");
  } else {
    createStore();
    displayCart();
  }
</script>

</body>
</html>
